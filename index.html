<div class="header">
    <h1>Système de Gestion Environnementale</h1>
    <p>Mine d'Or "AURIFERA"</p>
</div>

<div class="navbar">
    <a href="#" onclick="showSection('dashboard')">Tableau de Bord</a>
    <a href="#" onclick="showSection('incidents')">Registre des Incidents</a>
    <a href="#" onclick="showSection('suivi')">Suivi des Actions</a>
    <a href="#" onclick="showSection('rapports')">Rapports Réglementaires</a>
    <a href="#" onclick="showSection('communaute')">Engagement Communautaire</a>
</div>

<div class="container">
    <!-- Tableau de Bord -->
    <div id="dashboard" class="content-section">
        <h2>Tableau de Bord Principal</h2>
        <div class="kpi-container">
            <div class="kpi">
                <h3>Qualité de l'Eau (pH)</h3>
                <div class="value">7.2</div>
                <div class="unit">pH (Bassin de décantation)</div>
            </div>
            <div class="kpi alert">
                <h3>Cyanure (Effluent)</h3>
                <div class="value">0.25</div>
                <div class="unit">mg/L - ALERTE</div>
            </div>
            <div class="kpi">
                <h3>Qualité de l'Air (PM2.5)</h3>
                <div class="value">35</div>
                <div class="unit">µg/m³</div>
            </div>
            <div class="kpi">
                <h3>Production de Déchets</h3>
                <div class="value">150</div>
                <div class="unit">Tonnes/jour</div>
            </div>
        </div>
        <div style="margin-top: 40px;">
            <h3>Graphique de la Qualité de l'Eau (30 derniers jours)</h3>
            <img src="https://i.imgur.com/7gZ1W2U.png" alt="Graphique de la qualité de l'eau" style="width:100%; max-width:800px; border-radius:5px;">
        </div>
    </div>

    <!-- Registre des Incidents -->
    <div id="incidents" class="content-section" style="display:none;">
        <h2>Registre des Incidents Environnementaux</h2>
        <button class="btn" onclick="openModal('incidentModal')">Enregistrer un nouvel incident</button>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Date et Heure</th>
                    <th>Type d'Incident</th>
                    <th>Description</th>
                    <th>Niveau de Gravité</th>
                    <th>Statut</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="incidentTableBody">
                <tr>
                    <td>INC-001</td>
                    <td>2025-08-10 14:30</td>
                    <td>Déversement</td>
                    <td>Fuite mineure d'huile hydraulique près du concasseur primaire.</td>
                    <td>Faible</td>
                    <td>Clos</td>
                    <td><button class="btn" onclick="alert('Détails de l\'incident INC-001 affichés.')">Détails</button></td>
                </tr>
                <tr style="background-color: #fdebd0;">
                    <td>INC-002</td>
                    <td>2025-08-12 09:15</td>
                    <td>Dépassement de limite</td>
                    <td>Concentration de cyanure dans l'effluent de 0.25 mg/L.</td>
                    <td>Élevé</td>
                    <td>Ouvert</td>
                    <td><button class="btn btn-danger" onclick="alert('Détails de l\'incident INC-002 affichés.')">Détails</button></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Suivi des Actions Correctives -->
    <div id="suivi" class="content-section" style="display:none;">
        <h2>Suivi des Actions Correctives et Préventives</h2>
        <table>
            <thead>
                <tr>
                    <th>ID Action</th>
                    <th>Liée à l'Incident</th>
                    <th>Description de l'Action</th>
                    <th>Responsable</th>
                    <th>Échéance</th>
                    <th>Statut</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>AC-001</td>
                    <td>INC-001</td>
                    <td>Nettoyage de la zone contaminée et remplacement du joint défectueux.</td>
                    <td>Équipe de maintenance</td>
                    <td>2025-08-10</td>
                    <td>Complété</td>
                </tr>
                <tr>
                    <td>AC-002</td>
                    <td>INC-002</td>
                    <td>Investigation de la cause du pic de cyanure.</td>
                    <td>Superviseur environnemental</td>
                    <td>2025-08-13</td>
                    <td>En cours</td>
                </tr>
                 <tr>
                    <td>AP-001</td>
                    <td>INC-002</td>
                    <td>Révision de la procédure de dosage du réactif de destruction du cyanure.</td>
                    <td>Ingénieur de procédé</td>
                    <td>2025-08-20</td>
                    <td>Non débuté</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Rapports Réglementaires -->
    <div id="rapports" class="content-section" style="display:none;">
        <h2>Génération de Rapports Réglementaires</h2>
        <div class="form-group">
            <label for="report-type">Type de Rapport :</label>
            <select id="report-type">
                <option>Rapport mensuel de suivi environnemental</option>
                <option>Rapport de non-conformité</option>
                <option>Bilan annuel des émissions</option>
            </select>
        </div>
         <div class="form-group">
            <label for="report-period">Période :</label>
            <input type="month" id="report-period" value="2025-07">
        </div>
        <button class="btn" onclick="alert('Le rapport a été généré et est prêt pour le téléchargement.')">Générer le rapport</button>
    </div>
    
    <!-- Engagement Communautaire -->
    <div id="communaute" class="content-section" style="display:none;">
        <h2>Journal d'Engagement Communautaire</h2>
         <button class="btn" onclick="openModal('communityModal')">Nouvelle Entrée</button>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type d'Interaction</th>
                    <th>Parties Prenantes</th>
                    <th>Sujet</th>
                    <th>Résumé</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>2025-07-25</td>
                    <td>Réunion publique</td>
                    <td>Représentants du village voisin, ONG locales</td>
                    <td>Présentation du rapport environnemental trimestriel.</td>
                    <td>Questions posées sur la qualité de l'eau et les mesures de contrôle de la poussière. Engagement pris de fournir des données de surveillance supplémentaires.</td>
                </tr>
                <tr>
                    <td>2025-08-12</td>
                    <td>Communication proactive</td>
                    <td>Communauté locale via radio et communiqué</td>
                    <td>Notification de l'incident de dépassement de limite de cyanure (INC-002).</td>
                    <td>Information transparente sur l'incident, les mesures prises et l'absence de risque pour la santé publique en aval.</td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

<!-- Modal pour Nouvel Incident -->
<div id="incidentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('incidentModal')">&times;</span>
        <h2>Enregistrer un Nouvel Incident</h2>
        <form id="incidentForm" onsubmit="addIncident(event)">
            <div class="form-group">
                <label for="incident-date">Date et Heure de l'Incident :</label>
                <input type="datetime-local" id="incident-date" required>
            </div>
            <div class="form-group">
                <label for="incident-type">Type d'Incident :</label>
                <select id="incident-type" required>
                    <option value="">Sélectionnez un type</option>
                    <option value="Déversement">Déversement (produit chimique, hydrocarbure)</option>
                    <option value="Dépassement de limite">Dépassement de limite (eau, air)</option>
                    <option value="Érosion">Érosion anormale / Instabilité de terrain</option>
                    <option value="Nuisance">Nuisance (poussière, bruit, odeur)</option>
                     <option value="Faune">Incident lié à la faune</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>
            <div class="form-group">
                <label for="incident-description">Description détaillée :</label>
                <textarea id="incident-description" rows="4" required></textarea>
            </div>
             <div class="form-group">
                <label for="incident-location">Localisation précise :</label>
                <input type="text" id="incident-location" placeholder="Ex: Près du bassin de résidus, secteur nord-est" required>
            </div>
            <div class="form-group">
                <label for="incident-severity">Niveau de Gravité estimé :</label>
                <select id="incident-severity" required>
                    <option value="Faible">Faible</option>
                    <option value="Modéré">Modéré</option>
                    <option value="Élevé">Élevé</option>
                    <option value="Critique">Critique</option>
                </select>
            </div>
             <div class="form-group">
                <label for="initial-actions">Mesures immédiates prises :</label>
                <textarea id="initial-actions" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn">Enregistrer l'Incident</button>
        </form>
    </div>
</div>

 <!-- Modal pour Engagement Communautaire -->
<div id="communityModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('communityModal')">&times;</span>
        <h2>Nouvelle Entrée au Journal d'Engagement</h2>
        <form onsubmit="alert('Nouvelle entrée enregistrée.'); closeModal('communityModal'); return false;">
            <div class="form-group">
                <label>Date :</label>
                <input type="date" required>
            </div>
            <div class="form-group">
                <label>Type d'Interaction :</label>
                <select required>
                    <option>Réunion publique</option>
                    <option>Comité de suivi</option>
                    <option>Communication (presse, radio)</option>
                    <option>Gestion de plainte</option>
                     <option>Visite de site</option>
                </select>
            </div>
            <div class="form-group">
                <label>Parties Prenantes Impliquées :</label>
                <input type="text" placeholder="Ex: Chef du village, Association des agriculteurs" required>
            </div>
            <div class="form-group">
                <label>Sujet principal :</label>
                <input type="text" required>
            </div>
            <div class="form-group">
                <label>Résumé de l'interaction et engagements pris :</label>
                <textarea rows="5" required></textarea>
            </div>
            <button type="submit" class="btn">Enregistrer</button>
        </form>
    </div>
</div>

<script>
    // Fonction pour afficher la section sélectionnée et masquer les autres
    function showSection(sectionId) {
        // Cacher toutes les sections de contenu
        var sections = document.getElementsByClassName('content-section');
        for (var i = 0; i < sections.length; i++) {
            sections[i].style.display = 'none';
        }
        // Afficher la section désirée
        document.getElementById(sectionId).style.display = 'block';
    }

    // Fonctions pour la gestion des modales
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'block';
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    // Fermer la modale si l'utilisateur clique en dehors de celle-ci
    window.onclick = function(event) {
        var modals = document.getElementsByClassName('modal');
        for (var i = 0; i < modals.length; i++) {
            if (event.target == modals[i]) {
                modals[i].style.display = "none";
            }
        }
    }

    // Ajouter un nouvel incident au tableau
    function addIncident(event) {
        event.preventDefault(); // Empêcher le rechargement de la page

        // Récupérer les valeurs du formulaire
        const date = document.getElementById('incident-date').value;
        const type = document.getElementById('incident-type').value;
        const description = document.getElementById('incident-description').value;
        const severity = document.getElementById('incident-severity').value;
        
        const newIncidentId = 'INC-' + String(document.getElementById('incidentTableBody').rows.length + 1).padStart(3, '0');
        const formattedDate = new Date(date).toLocaleString('fr-FR');

        // Créer une nouvelle ligne pour le tableau
        const tableBody = document.getElementById('incidentTableBody');
        const newRow = tableBody.insertRow(0); // Insérer en haut
        newRow.style.backgroundColor = '#fdebd0'; // Mettre en évidence la nouvelle ligne

        // Insérer les cellules
        newRow.innerHTML = `
            <td>${newIncidentId}</td>
            <td>${formattedDate}</td>
            <td>${type}</td>
            <td>${description}</td>
            <td>${severity}</td>
            <td>Ouvert</td>
            <td><button class="btn btn-danger" onclick="alert('Détails de l\'incident ${newIncidentId} affichés.')">Détails</button></td>
        `;

        // Fermer la modale et réinitialiser le formulaire
        closeModal('incidentModal');
        document.getElementById('incidentForm').reset();
         // Afficher un message de confirmation
        alert('Le nouvel incident a été enregistré avec succès.');
    }


    // Afficher le tableau de bord par défaut au chargement
    document.addEventListener('DOMContentLoaded', function() {
        showSection('dashboard');
    });
</script>
